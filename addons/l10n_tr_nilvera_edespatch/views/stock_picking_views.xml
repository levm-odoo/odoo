<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_picking_internal_search_inherit_l10n_tr_nilvera_edespatch" model="ir.ui.view">
        <field name="name">stock.picking.internal.search.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="//group" position="inside">
                <filter 
                    string="GİB e-Despatch State"
                    name="l10n_tr_nilvera_despatch_state"
                    context="{'group_by': 'l10n_tr_nilvera_despatch_state'}"
                />
            </xpath>
        </field>
    </record>

    <record id="view_picking_form_inherit_edelivery_note" model="ir.ui.view">
        <field name="name">view.picking.form.inherit.edelivery.note</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page name="edispatch" string="e-Despatch" invisible="country_code != 'TR' or picking_type_code != 'outgoing'">
                    <group>
                        <group name="delivery_details" string="General Information">
                            <field name="l10n_tr_nilvera_despatch_scenario" />
                            <field name="l10n_tr_nilvera_despatch_type"/>
                            <field name="l10n_tr_nilvera_carrier_id" domain="[('is_company', '=', True)]"/>
                            <field name="l10n_tr_nilvera_delivery_printed_number" invisible="l10n_tr_nilvera_despatch_type != 'MATBUDAN'"/>
                            <field name="l10n_tr_nilvera_delivery_date" invisible="l10n_tr_nilvera_despatch_type != 'MATBUDAN'"/>
                        </group>
                        <group name="additionals" string="Additional Information">
                            <field name="l10n_tr_nilvera_buyer_id"/>
                            <field name="l10n_tr_nilvera_seller_supplier_id"/>
                            <field name="l10n_tr_nilvera_buyer_originator_id"/>
                            <field name="l10n_tr_nilvera_delivery_notes"/>
                            <field name="l10n_tr_nilvera_despatch_state"/>
                        </group>
                    </group>
                    <group>
                        <group name="vehicles" string="Vehicle Information">
                            <field name="l10n_tr_vehicle_plate"/>
                            <field name="l10n_tr_nilvera_trailer_plate_ids" widget="many2many_tags"/>
                        </group>
                        <group name="driver_details" string="Driver Information">
                            <field name="l10n_tr_nilvera_driver_ids" widget="many2many_tags" create="0" group_create="0" domain="[('is_company', '=', False)]"/>
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//sheet" position="before">
                <field name="l10n_tr_nilvera_edespatch_warnings" invisible="1"/>
                <div class="m-0" name="warnings">
                    <field name="l10n_tr_nilvera_edespatch_warnings" class="o_field_html" widget="actionable_errors"/>
                </div>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.server" id="action_export_edelivery_note">
        <field name="name">Generate GİB e-Despatch (XML)</field>
        <field name="model_id" ref="model_stock_picking"/>
        <field name="binding_model_id" ref="l10n_tr_nilvera_edespatch.model_stock_picking" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
action = records.action_export_delivery_note()
        </field>
    </record>

    <record model="ir.actions.server" id="action_mark_edespatch_status">
        <field name="name">Mark as sent (GİB e-Despatch)</field>
        <field name="model_id" ref="model_stock_picking"/>
        <field name="binding_model_id" ref="l10n_tr_nilvera_edespatch.model_stock_picking" />
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
action = records.action_mark_edespatch_status()
        </field>
    </record>
</odoo>
