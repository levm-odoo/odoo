<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!-- Options
    * reminder_light: no text displayed
    * reminder_small: text displayed as smallF
    * light_theme: bell is white/gold if set; otherwse bell is gray / white
 -->
<template id="track_widget_reminder">
    <t t-set="_btn_style" t-value="'btn-link' if reminder_light else (track.is_reminder_on and '') or ''"/>
    <t t-set="_btn_size" t-value="'btn-sm' if reminder_small else ''"/>
<!--    <div t-att-class="'o_wetrack_js_reminder %s %s' % (_btn_style, _btn_size)" role="button" data-bs-toggle="modal" data-bs-target="#modal_email_reminder">-->
    <div t-att-class="'o_wetrack_js_reminder %s %s' % (_btn_style, _btn_size)" role="button">
        <t t-if="track.is_reminder_on" t-set="title">Favorite On</t>
        <t t-else="track.is_reminder_on" t-set="title">Set Favorite</t>
        <i t-att-class="'fa fa-bell%s %s' % ('' if track.is_reminder_on else '-o', 'text-white' if reminder_light and not light_theme else 'text-dark')"
           t-att-data-track-id="track.id"
           t-att-title="title"
           t-att-data-is-reminder-light="reminder_light"
           t-att-data-reminder-on="bool(track.is_reminder_on)"></i>
    </div>
</template>


    <template id="modal_email_reminder">
        <div id="modal_email_reminder">
            <div class="modal fade modal_shown show" data-bs-backdrop="static" data-bs-keyboard="false"
                 tabindex="-1" aria-labelledby="staticBackdropLabel" style="display: block;" aria-modal="true"
                 role="dialog">
                <div class="modal-dialog">
                    <form id="email_reminder_form"
                          t-attf-action="/event/post-event-track-email-reminder" method="post"
                          class="js_website_submit_form">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <div class="modal-content">
                            <div class="modal-header align-items-center">
                                <h4 class="modal-title">Add reminder via email</h4>
                                <button type="button" class="btn-close" onclidata-bs-dismiss="modal"
                                        aria-label="Close"/>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-lg-12 mt-2">
                                        <label>Email</label>
                                        <span>*</span>
                                        <input class="form-control" t-att-type="email" t-attf-name="email"
                                               t-att-required="True"/>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer border-top">
                                <button type="button" class="btn btn-secondary btn-cancel js_goto_event" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-primary a-submit">Confirm</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <script>
                modalEmailReminder = $("#modal_email_reminder");
                btnClose = modalEmailReminder.find(".btn-close").first();
                btnCancel = modalEmailReminder.find(".btn-cancel").first();
                function deleteModal(){
                    modalEmailReminder.remove();
                }
                btnClose.on("click", deleteModal);
                btnCancel.on("click", deleteModal);
                btnSubmit = modalEmailReminder.find(".a-submit").first();
                emailReminderForm = $("#email_reminder_form");
                btnSubmit.on("click", function(ev){
                        ev.preventDefault();
                        $.ajax({
                        url: emailReminderForm.attr("action"),
                        method: emailReminderForm.attr("method"),
                        data: emailReminderForm.serializeArray(),
                    }).then( function() {
                        modalEmailReminder.slideUp().then( function(){
                            modalEmailReminder.remove();
                        });
                    });
                });
            </script>
        </div>
    </template>
</odoo>
