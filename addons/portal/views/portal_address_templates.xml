<?xml version="1.0"?>
<odoo>
    <template id="portal.address_details" name="Address Details">
        <div t-if="error_message" class="alert alert-danger" role="alert">
            <div class="col-lg-12">
                <t t-foreach="error_message" t-as="err"><t t-esc="err"/><br/></t>
            </div>
        </div>
        <div t-if="not partner_can_edit_vat" class="col-12 d-none d-xl-block">
            <small class="form-text text-muted">
                Company name, VAT Number and country can not be changed once document(s) have been issued for your account.
                <br/>Please contact us directly for that operation.
            </small>
        </div>
        <div id="div_name" class="col-lg-12 mb-2">
            <label class="col-form-label" for="o_name">Full name</label>
            <input
                id="o_name"
                type="text"
                name="name"
                t-att-value="name or partner_sudo.name"
                class="form-control"
            />
        </div>
        <div class="w-100"/>
        <div id="div_email" class="col-lg-6 mb-2">
            <label class="col-form-label" for="o_email">Email</label>
            <input
                id="o_email"
                type="email"
                name="email"
                t-att-value="email or partner_sudo.email"
                class="form-control"
            />
        </div>
        <div id="div_phone" class="col-lg-6 mb-2">
            <label class="col-form-label" for="o_phone">Phone</label>
            <input
                id="o_phone"
                type="tel"
                name="phone"
                t-att-value="phone or partner_sudo.phone"
                class="form-control"
            />
        </div>
        <t name="o_b2b_fields">
            <div class="w-100"/>
            <t t-if="show_vat">
                <t t-set="vat_warning" t-value="partner_sudo.vat and not can_edit_vat"/>
                <div id="company_name_div" class="col-lg-6 mb-2">
                    <label
                        class="col-form-label fw-normal label-optional"
                        for="o_company_name"
                    >
                        Company Name
                    </label>
                    <input
                        id="o_company_name"
                        type="text"
                        name="company_name"
                        t-att-value="partner_sudo.commercial_company_name"
                        t-att-disabled="'1' if vat_warning or not has_invoice else None"
                        class="form-control"
                    />
                    <small
                        t-if="vat_warning"
                        class="form-text text-muted d-block d-lg-none"
                    >
                        Changing company name is not allowed once document(s) have been issued for
                        your account. Please contact us directly for this operation.
                    </small>
                </div>
                <div id="div_vat" class="col-lg-6 mb-2">
                    <label class="col-form-label fw-normal label-optional" for="o_vat">
                        <t t-out="vat_label"/>
                    </label>
                    <input
                        type="text"
                        id="o_vat"
                        name="vat"
                        t-att-value="partner_sudo.vat"
                        t-att-disabled="'1' if vat_warning or has_invoice else None"
                        class="form-control"
                    />
                    <small
                        t-if="vat_warning"
                        class="form-text text-muted d-block d-lg-none"
                    >
                        Changing VAT number is not allowed once document(s) have been issued for
                        your account. Please contact us directly for this operation.
                    </small>
                </div>
                <div
                    t-if="vat_warning"
                    class="col-12 d-none d-lg-block mb-1"
                >
                    <small class="form-text text-muted">
                        Changing company name or VAT number is not allowed once document(s) have
                        been issued for your account. Please contact us directly for this
                        operation.
                    </small>
                </div>
            </t>
        </t>
        <div id="div_street" class="col-lg-12 mb-2">
            <label class="col-form-label" for="o_street">
                Street and Number
            </label>
            <input
                name="street"
                id="o_street"
                type="text"
                class="form-control"
                t-att-value="street or partner_sudo.street"
            />
        </div>
        <div id="div_street2" class="col-lg-12 mb-2">
            <label class="col-form-label label-optional" for="o_street2">
                Apartment, suite, etc.
            </label>
            <input
                id="o_street2"
                type="text"
                name="street2"
                class="form-control"
                t-att-value="street2 or partner_sudo.street2"
            />
        </div>
        <div class="w-100"/>
        <t t-if="zip_before_city">
            <div id="div_zip" class="col-md-4 mb-2">
                <label class="col-form-label label-optional" for="o_zip">
                    Zip Code
                </label>
                <input
                    id="o_zip"
                    type="text"
                    name="zip"
                    class="form-control"
                    t-att-value="zipcode or partner_sudo.zip"
                />
            </div>
        </t>
        <div id="div_city" class="col-md-8 mb-2">
            <label class="col-form-label" for="o_city">City</label>
            <input
                id="o_city"
                type="text"
                name="city"
                class="form-control"
                t-att-value="city or partner_sudo.city"
            />
        </div>
        <t t-if="not zip_before_city">
            <div id="div_zip" class="col-md-4 mb-2">
                <label class="col-form-label label-optional" for="o_zip">
                    Zip Code
                </label>
                <input
                    id="o_zip"
                    type="text"
                    name="zip"
                    class="form-control"
                    t-att-value="zipcode or partner_sudo.zip"
                />
            </div>
        </t>
        <div class="w-100"/>
        <div id="div_country" class="col-lg-6 mb-2">
            <label class="col-form-label" for="o_country_id">
                Country
            </label>
            <select
                id="o_country_id"
                name="country_id"
                class="form-select"
                t-att-disabled="has_invoice"
            >
                <option value="">Country...</option>
                <t t-foreach="countries" t-as="c">
                    <option
                        t-att-value="c.id"
                        t-att-selected="c.id == int(country_id) if country_id else c.id == partner_sudo.country_id.id"
                        t-att-code="c.code"
                    >
                        <t t-esc="c.name"/>
                    </option>
                </t>
            </select>
        </div>
        <div
            id="div_state"
            class="col-lg-6 mb-2"
            t-att-style="not country_states and 'display: none'"
        >
            <label class="col-form-label" for="o_state_id">
                State / Province
            </label>
            <select
                id="o_state_id"
                name="state_id"
                class="form-select"
                t-att-disabled="has_invoice"
            >
                <option value="">State / Province...</option>
                <t t-foreach="country_states" t-as="s">
                    <option
                        t-att-value="s.id"
                        t-att-selected="s.id == (int(state_id) if state_id else partner_sudo.state_id.id)"
                    >
                        <t t-esc="s.name"/>
                    </option>
                </t>
            </select>
        </div>
    </template>

    <template id="portal.address_example">
        <input type="hidden" name="required_fields" t-att-value="'name,country_id'"/>
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between mt32 mb32">
            <a
                role="button"
                t-att-href="discard_url or '/my/'"
                class="btn btn-outline-secondary w-100 w-md-auto order-md-1 order-3"
            >
                <i class="fw-light fa fa-angle-left me-2"/>Discard
            </a>
            <div
                class="position-relative w-100 d-flex d-md-none justify-content-center align-items-center order-2 my-2 opacity-75"
            >
                <hr class="w-100"/>
                <span class="px-3">or</span>
                <hr class="w-100"/>
            </div>
            <button
                t-if="address_type"
                id="save_address"
                class="btn btn-primary w-100 w-md-auto order-1 order-md-3"
                type="submit"
            >
                <t name="save_address">
                    Save address
                </t>
                <i class="fw-light fa fa-angle-right ms-2"/>
            </button>
            <button t-else="" type="submit" class="btn btn-primary w-100 w-md-auto order-1 order-md-3">
                Save
            </button>
        </div>
    </template>

    <template id="portal.address" name="Address Management">
        <t t-set="no_footer" t-value="1"/>
        <t t-call="portal.portal_layout">
            <div id="wrap">
                <div class="o_portal_address_fill container py-2">
                    <div name="address_div" class="row">
                        <div class="oe_cart col-12 col-lg-8">
                            <div>
                                <t name="address_name">
                                    <t t-if="address_type == 'invoice'">
                                        <h3 class="mb-3">Billing address</h3>
                                    </t>
                                    <t t-elif="address_type == 'delivery'">
                                        <h3 class="mb-3">Delivery address</h3>
                                    </t>
                                    <t t-else="">
                                        <h3 class="mb-3">Contact Details</h3>
                                    </t>
                                </t>
                                <div id="errors"/> <!-- for js -->
                                <form
                                    t-att-action="'/portal/address/submit' if address_type else '/my/account'"
                                    method="post"
                                    name="address_form"
                                >
                                    <div name="address_details" class="row">
                                        <t t-call="portal.address_details"/>
                                    </div>
                                    <div t-attf-class="col-xl-6 mb-3" t-att-hidden="true">
                                        <label class="col-form-label label-optional" for="type">
                                            Use this address for
                                        </label>
                                        <select name="type" t-attf-class="form-select">
                                            <option
                                                value="other"
                                                t-att-selected="type == 'other' or partner_sudo.type == 'other'"
                                            />
                                            <option
                                                value="delivery"
                                                t-att-selected="type == 'delivery' or partner_sudo.type == 'delivery'"
                                            >
                                                Delivery
                                            </option>
                                            <option
                                                value="invoice"
                                                t-att-selected="type == 'invoice' or partner_sudo.type == 'invoice'"
                                            >
                                                Invoice
                                            </option>
                                            <option
                                                value="contact"
                                                t-att-selected="type == 'contact' or partner_sudo.type == 'contact'"
                                            >
                                                Contact
                                            </option>
                                        </select>
                                    </div>
                                    <input
                                        type="hidden"
                                        name="csrf_token"
                                        t-att-value="request.csrf_token()"
                                        t-nocache="The csrf token must always be up to date."
                                    />
                                    <input type="hidden" name="address_type" t-att-value="address_type"/>
                                    <input type="hidden" name="parent_id" t-att-value="parent_id"/>
                                    <t t-if="partner_id">
                                        <input type="hidden" name="partner_id" t-att-value="partner_id"/>
                                    </t>
                                    <t t-if="callback">
                                        <input type="hidden" name="callback" t-att-value="callback"/>
                                    </t>
                                    <!-- Example -->
                                    <t t-call="portal.address_example"/>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>