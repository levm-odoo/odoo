<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal.my_addresses">
        <t t-set="additional_title" t-value="'My Addresses'"/>
        <t t-call="portal.portal_layout">
            <h5 class="mt-4">Billing address</h5>
            <t t-set="address_url" t-valuef="/portal/address"/>
            <t t-call="portal.address_row">
                <t t-set="addresses" t-value="billing_addresses"/>
                <t t-set="address_type" t-value="'billing'"/>
                <t
                    t-set="selected_address"
                    t-value="partner_sudo.default_billing_address_id"
                />
            </t>
            <h5 class="mt-4">Shipping address</h5>
            <t t-call="portal.address_row">
                <t t-set="addresses" t-value="delivery_addresses"/>
                <t t-set="address_type" t-value="'delivery'"/>
                <t
                    t-set="selected_address"
                    t-value="partner_sudo.default_shipping_partner_id"
                />
            </t>
        </t>
    </template>

    <template id="portal.address_row">
        <div
            name="address_row"
            t-attf-class="row row-cols-md-2 row-cols-lg-3 g-3 flex-nowrap flex-md-wrap o_portal_address_row"
        >
            <t
                t-set="new_address_url"
                t-valuef="{{address_url}}?address_type={{address_type}}"
            />
            <div t-foreach="addresses" t-as="address" class="col-md">
                <t t-call="portal.address_kanban">
                    <t t-set="contact" t-value="address"/>
                    <t t-set="can_be_edited" t-value="contact._can_edited_by_current_customer()"/>
                    <t t-set="is_my_address_card" t-value="True"/>
                    <t t-set="selected" t-value="address == selected_address"/>
                </t>
            </div>
            <div name="add_address" class="col-md">
                <a
                    name="new_address_ref"
                    role="button"
                    t-att-href="new_address_url"
                    class="o_portal_add_address d-flex flex-column align-items-center justify-content-center h-100 p-4 mx-auto rounded text-decoration-none"
                    style="border: 1px dashed;"
                >
                    <i class="fa fa-plus fa-2x mb-2"/>Add Address
                </a>
            </div>
        </div>
    </template>

    <!-- Card view of addresses. -->
    <template id="address_kanban" name="Kanban address">
        <div
            name="address_card"
            t-attf-class="card o_portal_address_card position-relative h-100 #{
                selected and 'bg-primary border border-primary' or (not is_my_address_card and 'js_change_address')
            }"
            t-att-data-address-type="address_type"
            t-att-data-partner-id="contact.id"
        >
            <div class="card-body d-flex flex-column justify-content-between">
                <t t-out="contact" t-options="dict(widget='contact', fields=['name', 'address'], no_marker=True)"/>
                <div class="mt-3" t-if="can_be_edited">
                    <a
                        name="card_address_ref"
                        t-att-href="new_address_url + '&amp;partner_id=' + str(contact.id)"
                        class="js_edit_address btn btn-link p-0 mt-auto"
                        role="button"
                        title="Edit this address"
                        aria-label="Edit this address">
                        <i class="fa fa-pencil me-1"
                    />
                        Edit
                    </a>
                    <t t-if="not selected and is_my_address_card">
                        <span
                            t-if="not selected and contact.type != 'contact'"
                            id="delete-button"
                        >
                            <span class="mx-2">|</span>
                            <a
                                class="btn btn-link text-danger p-0 o_remove_address"
                                role="button"
                                title="Rmove this address"
                                aria-label="Remove this address"
                            >
                                Remove
                            </a>
                        </span>
                        <span id="default-button">
                            <span class="mx-2">|</span>
                            <a
                                class="btn btn-link p-0 o_set_as_default"
                                role="button"
                                title="Set Default"
                                aria-label="Set Default"
                            >
                                Set as default
                            </a>
                        </span>
                    </t>
                </div>
            </div>
        </div>
    </template>

    <template id="portal.address_name">
        <t t-if="address_type == 'billing'">
            <h3 class="mb-3">Billing address</h3>
        </t>
        <t t-elif="address_type == 'delivery'">
            <h3 class="mb-3">Delivery address</h3>
        </t>
        <t t-else="">
            <h3 class="mb-3">Your Address</h3>
        </t>
    </template>

    <template id="portal.address_details" name="Address Details">
        <div id="div_name" class="col-lg-12 mb-2">
            <label class="col-form-label" for="o_name">Full name</label>
            <input
                id="o_name"
                type="text"
                name="name"
                t-att-value="partner_sudo.name"
                class="form-control"
            />
        </div>
        <div class="w-100"/>
        <div
            id="div_email"
            class="col-lg-6 mb-2"
        >
            <label class="col-form-label" for="o_email">Email</label>
            <input
                id="o_email"
                type="email"
                name="email"
                t-att-value="partner_sudo.email"
                class="form-control"
            />
        </div>
        <div id="div_phone" class="col-lg-6 mb-2">
            <label class="col-form-label" for="o_phone">Phone</label>
            <input
                id="o_phone"
                type="tel"
                name="phone"
                t-att-value="partner_sudo.phone"
                class="form-control"
            />
        </div>
        <t name="o_b2b_fields" t-if="partner_sudo._display_b2b_fields()">
            <div class="w-100"/>
            <t t-if="show_vat">
                <t t-set="vat_warning" t-value="partner_sudo.vat and not can_edit_vat"/>
                <div id="company_name_div" class="col-lg-6 mb-2">
                    <label
                        class="col-form-label fw-normal label-optional"
                        for="o_company_name"
                    >
                        Company Name
                    </label>
                    <input
                        id="o_company_name"
                        type="text"
                        name="company_name"
                        t-att-value="partner_sudo.commercial_company_name"
                        t-att-readonly="'1' if vat_warning else None"
                        class="form-control"
                    />
                    <small t-if="vat_warning" class="form-text text-muted d-block d-lg-none">
                        Changing company name is not allowed once document(s) have been issued for
                        your account. Please contact us directly for this operation.
                    </small>
                </div>
                <div id="div_vat" class="col-lg-6 mb-2">
                    <label class="col-form-label fw-normal label-optional" for="o_vat">
                        <t t-out="vat_label"/>
                    </label>
                    <input
                        type="text"
                        id="o_vat"
                        name="vat"
                        t-att-value="partner_sudo.vat"
                        t-att-readonly="'1' if vat_warning else None"
                        class="form-control"
                    />
                    <small t-if="vat_warning" class="form-text text-muted d-block d-lg-none">
                        Changing VAT number is not allowed once document(s) have been issued for
                        your account. Please contact us directly for this operation.
                    </small>
                </div>
                <div t-if="vat_warning" class="col-12 d-none d-lg-block mb-1">
                    <small class="form-text text-muted">
                        Changing company name or VAT number is not allowed once document(s) have been
                        issued for your account. Please contact us directly for this operation.
                    </small>
                </div>
            </t>
        </t>
        <div id="div_street" class="col-lg-12 mb-2">
            <label class="col-form-label" for="o_street">
                Street and Number
            </label>
            <input
                name="street"
                id="o_street"
                type="text"
                class="form-control"
                t-att-value="partner_sudo.street"
            />
        </div>
        <div id="div_street2" class="col-lg-12 mb-2">
            <label class="col-form-label label-optional" for="o_street2">
                Apartment, suite, etc.
            </label>
            <input
                id="o_street2"
                type="text"
                name="street2"
                class="form-control"
                t-att-value="partner_sudo.street2"
            />
        </div>
        <div class="w-100"/>
        <t t-if="zip_before_city">
            <div id="div_zip" class="col-md-4 mb-2">
                <label class="col-form-label label-optional" for="o_zip">
                    Zip Code
                </label>
                <input
                    id="o_zip"
                    type="text"
                    name="zip"
                    class="form-control"
                    t-att-value="partner_sudo.zip"
                />
            </div>
        </t>
        <div id="div_city" class="col-md-8 mb-2">
            <label class="col-form-label" for="o_city">City</label>
            <input
                id="o_city"
                type="text"
                name="city"
                class="form-control"
                t-att-value="partner_sudo.city"
            />
        </div>
        <t t-if="not zip_before_city">
            <div id="div_zip" class="col-md-4 mb-2">
                <label class="col-form-label label-optional" for="o_zip">
                    Zip Code
                </label>
                <input
                    id="o_zip"
                    type="text"
                    name="zip"
                    class="form-control"
                    t-att-value="partner_sudo.zip"
                />
            </div>
        </t>
        <div class="w-100"/>
        <div id="div_country" class="col-lg-6 mb-2">
            <label class="col-form-label" for="o_country_id">
                Country
            </label>
            <select
                id="o_country_id"
                name="country_id"
                class="form-select"
            >
                <option value="">Country...</option>
                <t t-foreach="countries" t-as="c">
                    <option
                        t-att-value="c.id"
                        t-att-selected="c.id == (country.id if country else partner_sudo.country_id.id)"
                        t-att-code="c.code"
                    >
                        <t t-esc="c.name"/>
                    </option>
                </t>
            </select>
        </div>
        <div
            id="div_state"
            class="col-lg-6 mb-2"
            t-att-style="not country_states and 'display: none'"
        >
            <label class="col-form-label" for="o_state_id">
                State / Province
            </label>
            <select
                id="o_state_id"
                name="state_id"
                class="form-select"
            >
                <option value="">State / Province...</option>
                <t t-foreach="country_states" t-as="s">
                    <option
                        t-att-value="s.id"
                        t-att-selected="s.id == (int(state_id) if state_id else partner_sudo.state_id.id)"
                    >
                        <t t-esc="s.name"/>
                    </option>
                </t>
            </select>
        </div>
        <input
            type="hidden"
            name="csrf_token"
            t-att-value="request.csrf_token()"
            t-nocache="The csrf token must always be up to date."
        />
        <input type="hidden" name="address_type" t-att-value="address_type"/>
        <input type="hidden" name="use_delivery_as_billing" t-att-value="use_delivery_as_billing"/>
        <input type="hidden" name="parent_id" t-att-value="parent_id"/>
        <t t-if="partner_id">
            <input type="hidden" name="partner_id" t-att-value="partner_id"/>
        </t>
        <t t-if="callback">
            <input type="hidden" name="callback" t-att-value="callback"/>
        </t>
    </template>

    <template id="portal.address_example">
        <input type="hidden" name="required_fields" t-att-value="'name,country_id'"/>

        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between mt32 mb32">
            <a
                role="button"
                t-att-href="discard_url or '/my/'"
                class="btn btn-outline-secondary w-100 w-md-auto order-md-1 order-3"
            >
                <i class="fw-light fa fa-angle-left me-2"/>Discard
            </a>
            <div class="position-relative w-100 d-flex d-md-none justify-content-center align-items-center order-2 my-2 opacity-75">
                <hr class="w-100"/>
                <span class="px-3">or</span>
                <hr class="w-100"/>
            </div>
            <button id="save_address" class="btn btn-primary w-100 w-md-auto order-1 order-md-3">
                <t name="save_address_label">Save Address</t>
                <i class="fw-light fa fa-angle-right ms-2"/>
            </button>
        </div>
    </template>

    <template id="portal.portal_my_details" name="Contact Details">
        <t t-set="no_footer" t-value="1"/>
        <t t-call="portal.portal_layout">
            <t t-set="additional_title">Contact Details</t>
            <div class="o_customer_address_fill">
                <div class="row">
                    <div name="address_div" class="oe_clear_stucture col-12 col-lg-8">
                        <div>
                            <div id="errors"/> <!-- for js -->
                            <form
                                action="/portal/address/submit"
                                method="post"
                                name="address_form"
                                class="address_autoformat"
                                t-att-data-company-country-code="res_company.country_id.code"
                                t-att-data-submit-url="'/portal/address/submit'"
                            >
                                <div name="address_details" class="row">
                                    <t t-call="portal.address_details"/>
                                </div>
                                <!-- Example -->
                                <t t-call="portal.address_example"/>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="portal.address"  name="Address Management">
        <t t-set="no_footer" t-value="1"/>
        <t t-call="portal.portal_layout">
            <t t-set="additional_title">Address Management</t>
            <div class="o_customer_address_fill">
                <div class="row">
                    <div name="address_div" class="oe_clear_stucture col-12 col-lg-8">
                        <div>
                            <t t-call="portal.address_name"/>
                            <div id="errors"/> <!-- for js -->
                            <form
                                action="/portal/address/submit"
                                method="post"
                                name="address_form"
                                class="address_autoformat"
                                t-att-data-company-country-code="res_company.country_id.code"
                                t-att-data-submit-url="'/portal/address/submit'"
                            >
                                <div name="address_details" class="row">
                                    <t t-call="portal.address_details"/>
                                    <div name="use_same_address" class="col-lg-12" t-if="not partner_id">
                                        <t
                                            t-if="address_type == 'delivery'"
                                            t-set="other_address_type"
                                            t-value="'billing'"
                                        />
                                        <t t-else="" t-set="other_address_type" t-value="'delivery'"/>
                                        <div class="form-check form-switch mt-2 mb-3">
                                            <label id="use_delivery_as_billing_label">
                                            <input
                                                type="checkbox"
                                                id="use_delivery_as_billing"
                                                name="use_delivery_as_billing"
                                                class="form-check-input"
                                                t-att-checked="use_delivery_as_billing"
                                            /> Add same for <t t-out="other_address_type"/> address
                                        </label>
                                        </div>
                                    </div>
                                </div>
                                <!-- Example -->
                                <t t-call="portal.address_example"/>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
